<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <title>BlueAmp Infinite V5</title>
    <style>
        :root { --accent: #00d2ff; --glass: rgba(10, 25, 47, 0.75); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #02050a; color: white; font-family: sans-serif; overflow: hidden; }

        /* Full Screen Visualizer */
        #visualizer { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 1; opacity: 0.4; filter: blur(1px); }

        .app-container { position: relative; z-index: 10; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: space-between; }

        /* Lyrics Central */
        .lyrics-section { flex: 1; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .lyrics-window { transition: transform 0.5s ease; text-align: center; }
        .lyric-line { font-size: 1.6rem; font-weight: bold; padding: 10px 20px; opacity: 0.1; transition: 0.4s; }
        .lyric-line.active { opacity: 1; color: var(--accent); transform: scale(1.15); text-shadow: 0 0 20px var(--accent); }

        /* Bottom Panel */
        .bottom-panel { background: var(--glass); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px); padding: 20px; border-radius: 40px 40px 0 0; border-top: 1px solid rgba(0, 210, 255, 0.2); }
        
        #title { text-align: center; font-size: 14px; font-weight: bold; color: var(--accent); margin-bottom: 15px; letter-spacing: 1px; }

        .progress-box { display: flex; align-items: center; gap: 10px; margin-bottom: 20px; font-size: 10px; }
        input[type="range"] { flex: 1; accent-color: var(--accent); cursor: pointer; }

        /* Control Grid */
        .control-grid { display: grid; grid-template-columns: 1fr 1.5fr 1fr; gap: 10px; align-items: center; justify-items: center; }
        
        .side-ctrl { display: flex; flex-direction: column; align-items: center; gap: 10px; }
        
        .btn-main { background: rgba(0,210,255,0.1); border: 1px solid var(--accent); color: var(--accent); border-radius: 50%; cursor: pointer; transition: 0.2s; font-weight: bold; }
        .btn-main:active { transform: scale(0.9); background: var(--accent); color: #000; }

        .btn-nav { width: 50px; height: 50px; font-size: 10px; }
        .btn-play { width: 70px; height: 70px; font-size: 14px; }
        .btn-sub { width: 45px; height: 45px; font-size: 8px; border-style: dashed; opacity: 0.8; }

        #playlist-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 100; padding: 30px; }
        .song-item { padding: 12px; border-bottom: 1px solid #111; font-size: 14px; }
    </style>
</head>
<body>

<canvas id="visualizer"></canvas>

<div class="app-container">
    <div class="lyrics-section" onclick="showList()">
        <div id="lyric-wrap" class="lyrics-window">
            <div class="lyric-line active">BlueAmp Infinite</div>
            <div class="lyric-line">Tekan SCAN untuk memulai</div>
        </div>
    </div>

    <div class="bottom-panel">
        <div id="title">NO TRACK LOADED</div>

        <div class="progress-box">
            <span id="cT">0:00</span>
            <input type="range" id="seek" value="0">
            <span id="dT">0:00</span>
        </div>

        <div class="control-grid">
            <div class="side-ctrl">
                <button class="btn-main btn-nav" onclick="nav(-1)">PREV</button>
                <button class="btn-main btn-sub" onclick="alert('EQ: Normal Mode')">EQ</button>
            </div>

            <button class="btn-main btn-play" id="pBtn" onclick="toggle()">PLAY</button>

            <div class="side-ctrl">
                <button class="btn-main btn-nav" onclick="nav(1)">NEXT</button>
                <label class="btn-main btn-sub" style="display:flex; align-items:center; justify-content:center;">
                    SCAN
                    <input type="file" id="f" accept="audio/*" multiple onchange="scanFiles(this.files)" style="display:none;">
                </label>
            </div>
        </div>
        <center><small style="color:#555; margin-top:10px; display:block;">Tap screen to view playlist</small></center>
    </div>
</div>

<div id="playlist-modal" onclick="this.style.display='none'">
    <h2 style="color: var(--accent);">Daftar Lagu</h2>
    <div id="list-div"></div>
</div>

<script>
    const audio = new Audio();
    let list = [], cur = 0, actx, ana, src, canv, ctx;
    
    const lyrics = ["Scanning your soul...", "Music is the answer", "Infinite Blue Energy", "BlueAmp Experience", "Deep Frequency", "Zero Gravity Sound"];

    function scanFiles(files) {
        if(files.length === 0) return;
        list = [];
        for (let f of files) {
            list.push({ n: f.name.replace(/\.[^/.]+$/, "").toUpperCase(), u: URL.createObjectURL(f) });
        }
        play(0);
    }

    function play(i) {
        if(!list[i]) return;
        cur = i; audio.src = list[i].u;
        document.getElementById('title').innerText = list[i].n;
        document.getElementById('pBtn').innerText = "PAUSE";
        audio.play(); 
        initVis();
        
        // Reset lirik
        const wrap = document.getElementById('lyric-wrap');
        wrap.innerHTML = lyrics.map(l => `<div class="lyric-line">${l}</div>`).join('');
    }

    function toggle() {
        if(!audio.src) return;
        audio.paused ? (audio.play(), document.getElementById('pBtn').innerText="PAUSE") : (audio.pause(), document.getElementById('pBtn').innerText="PLAY");
    }

    function nav(d) { 
        if(list.length === 0) return;
        cur = (cur + d + list.length) % list.length; 
        play(cur); 
    }

    function showList() {
        if(list.length === 0) return;
        const modal = document.getElementById('playlist-modal');
        const div = document.getElementById('list-div');
        div.innerHTML = list.map((s, i) => `<div class="song-item" style="color:${i===cur? '#00d2ff':'#fff'}" onclick="play(${i})">${s.n}</div>`).join('');
        modal.style.display = 'block';
    }

    audio.ontimeupdate = () => {
        if (isNaN(audio.duration)) return;
        const s = document.getElementById('seek');
        s.value = (audio.currentTime / audio.duration) * 100;
        
        const lines = document.querySelectorAll('.lyric-line');
        let index = Math.floor((audio.currentTime / audio.duration) * lines.length);
        lines.forEach((l, i) => l.classList.toggle('active', i === index));
        document.getElementById('lyric-wrap').style.transform = `translateY(-${index * 60}px)`;

        const m = (t) => Math.floor(t/60) + ":" + Math.floor(t%60).toString().padStart(2,'0');
        document.getElementById('cT').innerText = m(audio.currentTime);
        document.getElementById('dT').innerText = m(audio.duration);
    };

    document.getElementById('seek').oninput = (e) => audio.currentTime = (e.target.value / 100) * audio.duration;

    function initVis() {
        if (actx) return;
        actx = new (window.AudioContext || window.webkitAudioContext)();
        ana = actx.createAnalyser();
        src = actx.createMediaElementSource(audio);
        src.connect(ana); ana.connect(actx.destination);
        canv = document.getElementById('visualizer');
        ctx = canv.getContext('2d');
        resize(); draw();
    }

    function resize() { canv.width = window.innerWidth; canv.height = window.innerHeight; }
    window.onresize = resize;

    function draw() {
        requestAnimationFrame(draw);
        let d = new Uint8Array(ana.frequencyBinCount);
        ana.getByteFrequencyData(d);
        ctx.clearRect(0, 0, canv.width, canv.height);
        
        let bass = (d[0]+d[1]+d[2])/3;
        document.body.style.background = `radial-gradient(circle at center, rgba(0, 210, 255, ${bass/1000}) 0%, #02050a 100%)`;

        ctx.fillStyle = 'rgba(0, 210, 255, 0.3)';
        let bars = 50;
        let w = canv.width / bars;
        for (let i = 0; i < bars; i++) {
            let h = (d[i] / 255) * canv.height * 0.4;
            ctx.fillRect(i * w, canv.height - h, w - 2, h);
            ctx.fillRect(i * w, 0, w - 2, h);
        }
    }
    audio.onended = () => nav(1);
</script>

</body>
</html>
